

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Working with datasets &#8212; h5cpp 0.7.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dealing with links and paths" href="links_and_paths.html" />
    <link rel="prev" title="Working with attributes" href="attributes.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="links_and_paths.html" title="Dealing with links and paths"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="attributes.html" title="Working with attributes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">h5cpp 0.7.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Users guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with datasets</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="working-with-datasets">
<h1>Working with datasets<a class="headerlink" href="#working-with-datasets" title="Permalink to this heading">¶</a></h1>
<section id="dataset-creation">
<span id="design-read-write"></span><h2>Dataset creation<a class="headerlink" href="#dataset-creation" title="Permalink to this heading">¶</a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>There will be something like a <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">create_dataset()</span></code> method for
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">group_t</span></code>. However, the signature is not entirely determined
yet.</p>
</div>
<p>The only thing we have right now is some pseudocode</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_t</span><span class="w"> </span><span class="n">dset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">.</span><span class="n">create_dataset</span><span class="p">(...);</span>
</pre></div>
</div>
</section>
<section id="extending-the-size-of-a-dataset">
<h2>Extending the size of a dataset<a class="headerlink" href="#extending-the-size-of-a-dataset" title="Permalink to this heading">¶</a></h2>
<p>Provided that the dataset has a chunked layout one can alter its size.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Not determined how the interface should look like. Maybe we should try to
stick to the API names as close as possible in order to avoid confusion
for people how know the C-API.</p>
</div>
</section>
<section id="reading-and-writing-data">
<h2>Reading and writing data<a class="headerlink" href="#reading-and-writing-data" title="Permalink to this heading">¶</a></h2>
<p>To read and write an entire dataset use the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">read()</span></code> and
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">write()</span></code> methods (see also <a class="reference internal" href="#design-read-write"><span class="std std-ref">Dataset creation</span></a>).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_t</span><span class="w"> </span><span class="n">dset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">[</span><span class="s">&quot;temperatures&quot;</span><span class="p">];</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">temperatures</span><span class="p">;</span>
<span class="n">dset</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">temperatures</span><span class="p">);</span>

<span class="c1">//or for writing</span>
<span class="n">dset</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">temperatures</span><span class="p">)</span>
</pre></div>
</div>
<section id="partial-io">
<h3>Partial IO<a class="headerlink" href="#partial-io" title="Permalink to this heading">¶</a></h3>
<p>In many cases the the total amount of data stored in a single dataset might be
to large to fit in your machines memory. In such situations we have to read
the data in smaller pieces. This can be done using partial IO.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_t</span><span class="w"> </span><span class="n">dset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">[</span><span class="s">&quot;images&quot;</span><span class="p">];</span>
<span class="n">dims_t</span><span class="w"> </span><span class="n">cdims</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">dset</span><span class="p">.</span><span class="n">current_dimensions</span><span class="p">();</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uint16</span><span class="o">&gt;</span><span class="w"> </span><span class="n">frame</span><span class="p">(</span><span class="n">cdims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cdims</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

<span class="n">index_range_t</span><span class="w"> </span><span class="nf">rx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cdims</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="n">ry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cdims</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

<span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">frame_index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">frame_index</span><span class="o">&lt;</span><span class="n">cdims</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="n">frame_index</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>

<span class="w">    </span><span class="c1">//the dataset_t::operator()(....) uses a variadic template to</span>
<span class="w">    </span><span class="c1">//gather all the indexes and returns an instance of hyperslab_t</span>
<span class="w">    </span><span class="c1">//which by itself provides the read and write methods to</span>
<span class="w">    </span><span class="c1">//read and write data to the selection determined by the hyperslab.</span>
<span class="w">    </span><span class="n">dset</span><span class="p">(</span><span class="n">frame_index</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">).</span><span class="n">read</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//do something with the frame</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="dataset-container-adapter">
<h2>Dataset container adapter<a class="headerlink" href="#dataset-container-adapter" title="Permalink to this heading">¶</a></h2>
<p>To simplify the above concept of looping along a particular dimension of
a dataset one could use the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">container_adapter</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">container_adapter_t</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">const_iterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>

<span class="w">        </span><span class="n">hyperslab_t</span><span class="w"> </span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">        </span><span class="n">hyperslab_t</span><span class="w"> </span><span class="nf">at</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">size</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>

<span class="w">        </span><span class="k">template</span><span class="o">&lt;</span>
<span class="w">                 </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<span class="w">                 </span><span class="k">typename</span><span class="w"> </span><span class="nc">std</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;!</span><span class="n">is_container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">=</span><span class="mi">0</span>
<span class="w">                </span><span class="o">&gt;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">push_back</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

<span class="w">        </span><span class="k">template</span><span class="o">&lt;</span>
<span class="w">                 </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<span class="w">                 </span><span class="k">typename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">is_container</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&gt;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">push_back</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

<span class="w">        </span><span class="n">const_iterator</span><span class="w"> </span><span class="nf">begin</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">        </span><span class="n">const_iterator</span><span class="w"> </span><span class="nf">end</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The container adapter for datasets provides an STL compliant container
interface for a multidimensional dataset along one dimension.</p>
<p>Reading data from</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">frame_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">h5</span><span class="o">::</span><span class="n">dataset_t</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">[</span><span class="s">&quot;detector_data&quot;</span><span class="p">];</span>

<span class="c1">//container adapter for dataset d along the first dimension</span>
<span class="n">container_adapter_t</span><span class="w"> </span><span class="nf">frames</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">frame_t</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">slab</span><span class="o">:</span><span class="w"> </span><span class="n">frames</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//process the frame</span>
<span class="w">    </span><span class="n">slab</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="appending-data">
<h3>Appending data<a class="headerlink" href="#appending-data" title="Permalink to this heading">¶</a></h3>
<p>The <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">container_adapter</span></code> template also provides a
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">push_back()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">frame_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">h5</span><span class="o">::</span><span class="n">dataset_t</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">[</span><span class="s">&quot;detector_data&quot;</span><span class="p">];</span>
<span class="n">container_adapter_t</span><span class="w"> </span><span class="nf">frames</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">frame_t</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="n">measurement_running</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.....;</span><span class="w"> </span><span class="c1">//read some data</span>
<span class="w">    </span><span class="n">frames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">  </span><span class="c1">//store data in the dataset</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="stream-io">
<h2>Stream IO<a class="headerlink" href="#stream-io" title="Permalink to this heading">¶</a></h2>
<p>It would be nice to have something like IO streams for datasets.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">h5</span><span class="o">::</span><span class="n">dataset_t</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">[</span><span class="s">&quot;temperatures&quot;</span><span class="p">];</span>

<span class="c1">//create a new stream along the first dimension of a dataset</span>
<span class="n">h5</span><span class="o">::</span><span class="n">dataset_stream_t</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

<span class="k">while</span><span class="p">(</span><span class="n">measurement_running</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_temperature</span><span class="p">();</span>
<span class="w">    </span><span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">temperature</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or the other way around for reading</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">h5</span><span class="o">::</span><span class="n">dataset_t</span><span class="w"> </span><span class="n">datset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">[</span><span class="s">&quot;temperature&quot;</span><span class="p">];</span>
<span class="n">h5</span><span class="o">::</span><span class="n">dataset_stream_t</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

<span class="kt">double</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">stream</span><span class="p">.</span><span class="n">eof</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">stream</span><span class="o">&gt;&gt;</span><span class="n">temperature</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A possible implementation could be done based upon the
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">container_adapter_t</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">dataset_stream_t</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">container_adapter</span><span class="w"> </span><span class="n">_adapter</span><span class="p">;</span>
<span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">_position</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="n">dataset_stream_t</span><span class="p">();</span>

<span class="p">};</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Working with datasets</a><ul>
<li><a class="reference internal" href="#dataset-creation">Dataset creation</a></li>
<li><a class="reference internal" href="#extending-the-size-of-a-dataset">Extending the size of a dataset</a></li>
<li><a class="reference internal" href="#reading-and-writing-data">Reading and writing data</a><ul>
<li><a class="reference internal" href="#partial-io">Partial IO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dataset-container-adapter">Dataset container adapter</a><ul>
<li><a class="reference internal" href="#appending-data">Appending data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stream-io">Stream IO</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="attributes.html"
                          title="previous chapter">Working with attributes</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="links_and_paths.html"
                          title="next chapter">Dealing with links and paths</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><p>
  <h3 class='versions'>Versions</h3>
  <p>
    <ul>
      <li><a class="reference external" href="../index/../../latest/index.html">v:latest</a></li>
      <li><a class="reference external" href="../index/../../stable/index.html">v:stable</a></li>
      
      <li><a class="reference external" href="../index/../../v0.7.0/index.html">v0.7.0</a></li>
      <li><a class="reference external" href="../index/../../v0.6.1/index.html">v0.6.1</a></li>
      <li><a class="reference external" href="../index/../../v0.6.0/index.html">v0.6.0</a></li>
      <li><a class="reference external" href="../index/../../v0.5.2/index.html">v0.5.2</a></li>
      <li><a class="reference external" href="../index/../../v0.5.1/index.html">v0.5.1</a></li>
      <li><a class="reference external" href="../index/../../v0.5.0/index.html">v0.5.0</a></li>
      <li><a class="reference external" href="../index/../../v0.4.1/index.html">v0.4.1</a></li>
      <li><a class="reference external" href="../index/../../v0.3.3/index.html">v0.3.3</a></li>
      
    </ul>
  </p>
</p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="links_and_paths.html" title="Dealing with links and paths"
             >next</a> |</li>
        <li class="right" >
          <a href="attributes.html" title="Working with attributes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">h5cpp 0.7.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Users guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with datasets</a></li> 
      </ul>
    </div>
<li>generated on 2025-05-06 07:47:10 from docs_stable (ebffd97)</li>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Deutsches Elektronen-Synchrotron, European Spallation Source ERIC; generated on 2025-05-06 07:47:10 from docs_stable (ebffd97).
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>

  </body>
</html>